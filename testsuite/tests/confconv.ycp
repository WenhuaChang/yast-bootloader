/**
 * File:
 *  confconv.ycp
 *
 * Module:
 *  Bootloader configurator
 *
 * Summary:
 *  Testsuite for converting settings between bootloaders
 *
 * Authors:
 *  Jiri Srain <jsrain@suse.cz>
 *
 * $Id$
 *
 */

{
    import "Pkg";
    include "testsuite.ycp";
    include "bootloader/routines/convert.ycp";
//    import "BootGRUB";

    map EXEC = $["target" : $["bash_output": $["stdout" : "(hd0)"]]];
    map READ = $["target" : $["string" : "(hd0) /dev/hda
(hd1)   /dev/ida/c0d0
(fd0)   /dev/fd0
"]];

    Mode::test = true;

    BootGRUB::device_map = TEST (``(BootGRUB::readDeviceMap ()), [READ, $[], $[]], 0);

    TEST (``(liloSect2grubSect ([
	$[ "key" : "label", "value" : "sectlabel"],
	$[ "key" : "other", "value" : "/dev/hda2"]
	])), [], 0);

    TEST (``(liloSect2grubSect ([
	$[ "key" : "label", "value" : "section2"],
	$[ "key" : "image", "value" : "/boot/vmlinuz"],
	$[ "key" : "root", "value" : "/dev/hda3"],
	$[ "key" : "append", "value" : "append_opts"],
	$[ "key" : "vga", "value" : "789"],
	$[ "key" : "initrd", "value" : "/boot/initrd"],
	])), [], 0);

    TEST (``(liloSect2grubSect ([
        $[ "key" : "label", "value" : "section2"],
        $[ "key" : "image", "value" : "/boot/vmlinuz"],
        $[ "key" : "root", "value" : "/dev/hda3"],
        $[ "key" : "append", "value" : "append_opts"],
        $[ "key" : "vga", "value" : "789"],
        ])), [], 0);

    DUMP ("====================================================");

    TEST (``(grubSect2liloSect ([
	$[ "key" : "title", "value" : "section"],
	$[ "key" : "makeactive", "value" : "true"],
	$[ "key" : "chainloader", "value" : "+1"],
	$[ "key" : "root", "value" : "(hd0,2)"],
        ])), [], 0);

    TEST (``(grubSect2liloSect ([
        $[ "key" : "title", "value" : "section"],
	$[ "key" : "kernel", "value" : "(hd0,0)/vmlinuz root=/dev/hda3 vga=789 app_opt1 app_opt2"],
        ])), [], 0);

    TEST (``(grubSect2liloSect ([
        $[ "key" : "title", "value" : "section"],
        $[ "key" : "kernel", "value" : "(hd0,1)/vmlinuz root=/dev/hda3 app_opt1 app_opt2"],
        ])), [], 0);


    TEST (``(grubSect2liloSect ([
        $[ "key" : "title", "value" : "section"],
        $[ "key" : "kernel", "value" : "(hd0,0)/vmlinuz root=/dev/hda3 vga=789 app_opt1 app_opt2"],
	$[ "key" : "initrd", "value" : "(hd0,0)/initrd"],
        ])), [], 0);

    DUMP ("====================================================");

    TEST (``(grubGlob2liloGlob ([
	$[ "key" : "timeout", "value" : 8],
	$[ "key" : "gfxmenu", "value" : "(hd0,0)/message"],
	])), [], 0);

    TEST (``(grubGlob2liloGlob ([
        $[ "key" : "timeout", "value" : 8],
        $[ "key" : "gfxmenu", "value" : "(hd0,0)/message"],
	$[ "key" : "hiddenmenu", "value" : "true"],
        ])), [], 0);


    DUMP ("====================================================");

    TEST (``(liloGlob2grubGlob ([
        $[ "key" : "timeout", "value" : 80],
        $[ "key" : "message", "value" : "/boot/message"],
        ])), [], 0);

    TEST (``(liloGlob2grubGlob ([
        $[ "key" : "timeout", "value" : 80],
        $[ "key" : "message", "value" : "/boot/message"],
	$[ "key" : "prompt", "value" : "true"],
        ])), [], 0);


}


